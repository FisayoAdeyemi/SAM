Battery Dispatch PV Smoothing
1058
335
28
Numeric

1
17
Name
5
23
batt_dispatch_pvs_ac_lb
X
3
375
Y
3
198
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
-0.1
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
CheckBox

1
9
Name
5
30
batt_dispatch_pvs_ac_lb_enable
X
3
54
Y
3
198
Width
3
212
Height
3
24
Tool Tip
5
0
Caption
5
21
Enable AC lower bound
State
2
1
TabOrder
3
4294967295
Numeric

1
17
Name
5
23
batt_dispatch_pvs_ac_ub
X
3
375
Y
3
168
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
1.05
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
CheckBox

1
9
Name
5
30
batt_dispatch_pvs_ac_ub_enable
X
3
54
Y
3
168
Width
3
212
Height
3
24
Tool Tip
5
0
Caption
5
21
Enable AC upper bound
State
2
1
TabOrder
3
4294967295
Numeric

1
17
Name
5
32
batt_dispatch_pvs_battery_energy
X
3
882
Y
3
30
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0.2
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
31
batt_dispatch_pvs_battery_power
X
3
882
Y
3
60
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0.2
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
29
batt_dispatch_pvs_battery_rte
X
3
882
Y
3
90
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0.9
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
CheckBox

1
9
Name
5
36
batt_dispatch_pvs_curtail_as_control
X
3
54
Y
3
261
Width
3
164
Height
3
24
Tool Tip
5
0
Caption
5
26
Correct up-ramp violations
State
2
1
TabOrder
3
4294967295
CheckBox

1
9
Name
5
38
batt_dispatch_pvs_curtail_if_violation
X
3
54
Y
3
291
Width
3
164
Height
3
24
Tool Tip
5
0
Caption
5
18
Curtail violations
State
2
1
TabOrder
3
4294967295
Numeric

1
17
Name
5
40
batt_dispatch_pvs_forecast_shift_periods
X
3
375
Y
3
228
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
3
Mode
3
0
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
39
batt_dispatch_pvs_interconnection_limit
X
3
882
Y
3
150
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
20
batt_dispatch_pvs_kf
X
3
882
Y
3
258
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0.3
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
20
batt_dispatch_pvs_ki
X
3
882
Y
3
228
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
1.8
Mode
3
1
Format
3
1
Decimals
3
3
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
20
batt_dispatch_pvs_kp
X
3
882
Y
3
198
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
1.2
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
26
batt_dispatch_pvs_max_ramp
X
3
225
Y
3
120
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
10
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
30
batt_dispatch_pvs_nameplate_ac
X
3
882
Y
3
120
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
0
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
31
batt_dispatch_pvs_ramp_interval
X
3
225
Y
3
90
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
10
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
CheckBox

1
9
Name
5
39
batt_dispatch_pvs_short_forecast_enable
X
3
54
Y
3
228
Width
3
208
Height
3
24
Tool Tip
5
0
Caption
5
32
Enable short-term power forecast
State
2
1
TabOrder
3
4294967295
Numeric

1
17
Name
5
37
batt_dispatch_pvs_timestep_multiplier
X
3
225
Y
3
60
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
3
Mode
3
0
Format
3
0
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Numeric

1
17
Name
5
29
batt_dispatch_pvs_wf_timestep
X
3
225
Y
3
30
Width
3
90
Height
3
24
Tool Tip
5
0
Value
1
10
Mode
3
1
Format
3
1
Decimals
3
0
Prefix
5
0
Suffix
5
0
ThousandsSep
2
1
Editable
2
1
ForeColour
4
0
0
0
255
BackColour
4
255
255
255
255
TabOrder
3
4294967295
Button

1
8
Name
5
15
btn_BDPVS_reset
X
3
756
Y
3
291
Width
3
188
Height
3
24
Tool Tip
5
0
Caption
5
17
Reset to Defaults
TabOrder
3
4294967295
Label

1
13
Name
5
17
lbl_BDPVS_warning
X
3
393
Y
3
30
Width
3
276
Height
3
90
Tool Tip
5
0
Caption
5
190
You have selected a ramp interval greater than 30 minutes. While the PV Smoothing model will work with longer intervals, please note that it was designed for intervals of 30 minutes or less.
TextColour
4
255
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
GroupBox

1
8
Name
5
8
object 4
X
3
651
Y
3
183
Width
3
350
Height
3
140
Tool Tip
5
0
Caption
5
11
Multipliers
Bold
2
1
GroupBox

1
8
Name
5
10
object 419
X
3
6
Y
3
12
Width
3
1042
Height
3
322
Tool Tip
5
0
Caption
5
12
PV Smoothing
Bold
2
1
Label

1
13
Name
5
8
object 7
X
3
393
Y
3
123
Width
3
16
Height
3
18
Tool Tip
5
0
Caption
5
1
*
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
9
object 71
X
3
576
Y
3
171
Width
3
16
Height
3
18
Tool Tip
5
0
Caption
5
1
*
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0
Label

1
13
Name
5
10
object 714
X
3
252
Y
3
267
Width
3
356
Height
3
50
Tool Tip
5
0
Caption
5
128
* For the purposes of the PV smoothing model, nameplate is defined as the minimum of the AC nameplate and the interconnect limit
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
1
AlignRight
2
0
AlignTop
2
1
Label

1
13
Name
5
9
object 72
X
3
576
Y
3
201
Width
3
16
Height
3
18
Tool Tip
5
0
Caption
5
1
*
TextColour
4
0
0
0
255
Bold
2
0
FontSize
3
0
WordWrap
2
0
AlignRight
2
1
AlignTop
2
0

20
batt_dispatch_pvs_ac_lb
3
1
AC lower bound 
 fraction of nameplate
Battery Dispatch PV Smoothing
0
0
1
1
1
1
-0.1
Numeric
batt_dispatch_pvs_ac_lb_enable
3
1
 
 
Battery Dispatch PV Smoothing
0
0
1
1
1
1
0
CheckBox
batt_dispatch_pvs_ac_ub
3
1
 AC upper bound
 fraction of nameplate
Battery Dispatch PV Smoothing
0
0
1
1
1
1
1.05
Numeric
batt_dispatch_pvs_ac_ub_enable
3
1
 
 
Battery Dispatch PV Smoothing
0
0
1
1
1
1
0
CheckBox
batt_dispatch_pvs_battery_energy
3
1
 Battery energy
 kWhac
Battery Dispatch PV Smoothing
0
8
1
1
1
1
0
Numeric
batt_dispatch_pvs_battery_power
3
1
 Battery power
kWac
Battery Dispatch PV Smoothing
0
8
1
1
1
1
0
Numeric
batt_dispatch_pvs_battery_rte
3
1
 Battery round trip efficiency
 %
Battery Dispatch PV Smoothing
0
8
1
1
1
1
0
Numeric
batt_dispatch_pvs_curtail_as_control
3
1
 
 
Battery Dispatch PV Smoothing
0
0
1
1
1
1
0
CheckBox
batt_dispatch_pvs_curtail_if_violation
3
1
 
 
Battery Dispatch PV Smoothing
0
0
1
1
1
1
0
CheckBox
batt_dispatch_pvs_forecast_shift_periods
3
1
Forcasting window 
 periods of ramp intervals
Battery Dispatch PV Smoothing
0
0
1
1
1
1
3
Numeric
batt_dispatch_pvs_interconnection_limit
3
1
Interconnection limit
kWac
 
0
8
1
1
1
1
0
Numeric
batt_dispatch_pvs_kf
3
1
Forecast accumulation error multiplier (kf)
 
 
0
0
1
1
1
1
0.3
Numeric
batt_dispatch_pvs_ki
3
1
Return to rest SOC multiplier (ki)
 
 
0
0
1
1
1
1
1.8
Numeric
batt_dispatch_pvs_kp
3
1
Track PV power multiplier (kp)
 
 
0
0
1
1
1
1
1.2
Numeric
batt_dispatch_pvs_max_ramp
3
1
 Maximum ramp rate
 % of nameplate per ramp interval
Battery Dispatch PV Smoothing
0
0
1
1
1
1
10
Numeric
batt_dispatch_pvs_nameplate_ac
3
1
Nameplate
kWac
 
0
8
1
1
1
1
0
Numeric
batt_dispatch_pvs_ramp_interval
3
1
 Ramp interval
 minutes
Battery Dispatch PV Smoothing
0
8
1
1
1
1
10
Numeric
batt_dispatch_pvs_short_forecast_enable
3
1
 
 
Battery Dispatch PV Smoothing
0
0
1
1
1
1
0
CheckBox
batt_dispatch_pvs_timestep_multiplier
3
1
Ramp timestep multiplier
 
 
0
2
1
1
1
1
3
Numeric
batt_dispatch_pvs_wf_timestep
3
1
Weather file timestep
minutes
 
0
8
1
1
1
1
60
Numeric

944
equations{'batt_dispatch_pvs_wf_timestep'} = define() {
	return(${ui_step_minutes});
};

equations{'batt_dispatch_pvs_ramp_interval'} = define() {
	return(${batt_dispatch_pvs_wf_timestep}*${batt_dispatch_pvs_timestep_multiplier});
};

equations{'batt_dispatch_pvs_battery_energy'} = define() {
	return(${batt_computed_bank_capacity});
};

equations{'batt_dispatch_pvs_battery_power'} = define() {
	return(${batt_power_charge_max_kwdc});
};

equations{'batt_dispatch_pvs_interconnection_limit'} = define() {
	return(${grid_interconnection_limit_kwac});
};

equations{'batt_dispatch_pvs_nameplate_ac'} = define() {
	return(${total_inverter_capacity});// todo - generic? PV array only?
};


equations{'batt_dispatch_pvs_battery_rte'} = define() {
		if (${batt_ac_or_dc} == 1) {
			return (${batt_ac_dc_efficiency}*${batt_dc_ac_efficiency}/100.0);
		}
		else {
			return (${batt_dc_dc_efficiency}*${batt_inverter_efficiency_cutoff}/100.0);
		}
	};

1140
on_load{'Battery Dispatch PV Smoothing'} = define() {
	on_change{'batt_dispatch_pvs_timestep_multiplier'}();
	on_change{'batt_dispatch_pvs_ac_ub_enable'}();
	on_change{'batt_dispatch_pvs_ac_lb_enable'}();
	on_change{'batt_dispatch_pvs_short_forecast_enable'}();
};

on_change{ 'batt_dispatch_pvs_ac_ub_enable' } = define () {
	en_ub = value("batt_dispatch_pvs_ac_ub_enable");
	enable("batt_dispatch_pvs_ac_ub", en_ub);
};

on_change{ 'batt_dispatch_pvs_ac_lb_enable' } = define () {
	en_lb = value("batt_dispatch_pvs_ac_lb_enable");
	enable("batt_dispatch_pvs_ac_lb", en_lb);
};

on_change{ 'batt_dispatch_pvs_short_forecast_enable' } = define () {
	en_sf = value("batt_dispatch_pvs_short_forecast_enable");
	enable("batt_dispatch_pvs_forecast_shift_periods", en_sf);
};

on_change{ 'btn_BDPVS_reset' } = define () {
	value( 'batt_dispatch_pvs_kp', 1.2 );
	value( 'batt_dispatch_pvs_ki', 1.8 );
	value( 'batt_dispatch_pvs_kf', 0.3 );
};

on_change{ 'batt_dispatch_pvs_timestep_multiplier' } = define () {
	ramp_interval = to_real(value("batt_dispatch_pvs_ramp_interval"));
	show("lbl_BDPVS_warning", (ramp_interval > 30.0));
	refresh();
};
