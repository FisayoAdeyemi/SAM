folder = appdir() + "/../..";
outln(folder);

output_file = folder + "/test_ui_" + ostype() + ".csv";
file_num = open(output_file, "w");
if ( !file_num ) {
	outln("failed to open output file for writing:\n" + output_file );
	exit;
}

outln('writing to output file: ' + output_file );

outln( 'TECHNOLOGY\tFINANCING\tMESSAGES');
write_line(file_num,"TECHNOLOGY,FINANCING,ON_LOAD_MESSAGES");
query = true; // ask user whether to overwrite each configuration that has a defaults error
//Close any open projects and create a case to run
close_project();
create_case( 'Flat Plate PV', 'Residential', 'test_case');

//Keep track of the number of configurations
configs = 0;

//loop through all technologies
technologies = 	list_technologies();
for (t=0; t<#technologies; t++)
{
	if ((technologies[t] != "DSPT") 
	&& (technologies[t] != "Dish Stirling")
	&& (technologies[t] != "ISCC")
	&& (technologies[t] != "Retired"))
	{
		//Loop through all financing options for that technology
		financing = list_financing(technologies[t]);
		for(f=0; f<#financing; f++)
		{	

			//Write the technology and financing configuration to the file
			out( technologies[t] + '\t' + financing[f] + '\t' );
			configs++;
			
			//Check that the case and defaults load ok
			active_case( 'test_case' );
			//config = configuration(technologies[t], financing[f],true);
			configuration(technologies[t], financing[f]);
			input_pages = check_configuration( technologies[t], financing[f]) ;

			outln(input_pages);
			write_line(file_num,technologies[t] + ',' + financing[f] + ',' + input_pages);
		}
	} // skip DSPT
}

outln( 'Total Number of Configurations: ' + configs);
// Write line out for Travis CI scripts
write_line(file_num, "final_configuration_eof" + "," + "none" + "," + "NA" + ',' + "NA" + ',' + "NA" + ',');
